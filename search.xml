<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/07/01/hello-world/"/>
      <url>/2020/07/01/hello-world/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start">Quick Start<a class="post-anchor" href="#Quick-Start"></a></h2><h3 id="Create-a-new-post">Create a new post<a class="post-anchor" href="#Create-a-new-post"></a></h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">"My New Post"</span><br></code></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server">Run server<a class="post-anchor" href="#Run-server"></a></h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files">Generate static files<a class="post-anchor" href="#Generate-static-files"></a></h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites">Deploy to remote sites<a class="post-anchor" href="#Deploy-to-remote-sites"></a></h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>树形数据结构与扁平数据结构互转</title>
      <link href="/2019/12/19/%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84/"/>
      <url>/2019/12/19/%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h2 id="前言">前言<a class="post-anchor" href="#前言"></a></h2><p>近日有需求做链路日志系统，从 elasticsearch 查询到的日志数据是扁平化结构，数据中包含层级关系的字段，前端按照层级展示。</p><p>所以需要对扁平数据做树形处理</p><h2 id="数据源">数据源<a class="post-anchor" href="#数据源"></a></h2><ol><li><p>下面是单条数据结构：</p><figure class="highlight js"><table><tbody><tr><td class="code"><pre><code class="hljs js">{<br>     id: <span class="hljs-number">1</span>,<br>     pid: <span class="hljs-number">0</span>,<br>     name: <span class="hljs-string">'1/0'</span><br>}<br></code></pre></td></tr></tbody></table></figure><ul><li>id 为不重复索引值</li><li>pid 为父级 id</li></ul></li><li><p>下面简单构造一个扁平数据结构数据源</p><figure class="highlight js"><table><tbody><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> data = [<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'1/0'</span> },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'2/0'</span> },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">-1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'0/-1'</span> },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'3/1'</span> },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'4/3'</span> },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'6/5'</span> },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'5/0'</span> },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">pid</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'7/2'</span> }<br>]<br></code></pre></td></tr></tbody></table></figure></li></ol><h2 id="扁平数据结构-gt-树形数据结构">扁平数据结构=>树形数据结构<a class="post-anchor" href="#扁平数据结构-gt-树形数据结构"></a></h2><blockquote><p>对于下面的使用方法，是有一个 bug 的，那就是数据源的根父节点(最外层的父节点)，必须在数据源的首个位置（索引为 0），所以在使用本方法时需要依据 id 做一次排序</p></blockquote><figure class="highlight js"><table><tbody><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 先依据id做一次排序，确保根父节点，在数据源首位</span><br>data.sort(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =></span> a.id - b.id)<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flatToNested</span>(<span class="hljs-params">data</span>) </span>{<br>  <span class="hljs-keyword">let</span> temp = [],<br>    result = []<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < data.length; i++) {<br>    <span class="hljs-comment">// 将当前item塞入temp中(因为这一步，所以需要对数据源做排序)</span><br>    temp[data[i].id] = data[i]<br><br>    <span class="hljs-comment">// 判断temp中有没有当前item的父类</span><br>    <span class="hljs-keyword">if</span> (temp[data[i].pid]) {<br>      <span class="hljs-comment">// 判断childrenn，不存在则赋值空数组</span><br>      <span class="hljs-keyword">if</span> (!temp[[data[i].pid]][<span class="hljs-string">'children'</span>]) {<br>        temp[[data[i].pid]][<span class="hljs-string">'children'</span>] = []<br>      }<br><br>      <span class="hljs-comment">// 将当前item塞入父类children字段中</span><br>      temp[[data[i].pid]][<span class="hljs-string">'children'</span>].push(data[i])<br>    } <span class="hljs-keyword">else</span> {<br>      <span class="hljs-comment">// 在temp中找不到父类，就将item塞入result中</span><br>      result.push(data[i])<br>    }<br>  }<br><br>  <span class="hljs-keyword">return</span> result<br>}<br><br>flatToNested(data)<br></code></pre></td></tr></tbody></table></figure><p>处理完的数据：</p><figure class="highlight js"><table><tbody><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> data = [<br>  {<br>    id: <span class="hljs-number">0</span>,<br>    pid: <span class="hljs-number">-1</span>,<br>    name: <span class="hljs-string">'0/-1'</span>,<br>    children: [<br>      {<br>        id: <span class="hljs-number">1</span>,<br>        pid: <span class="hljs-number">0</span>,<br>        name: <span class="hljs-string">'1/0'</span>,<br>        children: [<br>          {<br>            id: <span class="hljs-number">2</span>,<br>            pid: <span class="hljs-number">1</span>,<br>            name: <span class="hljs-string">'2/0'</span>,<br>            children: [<br>              {<br>                id: <span class="hljs-number">7</span>,<br>                pid: <span class="hljs-number">2</span>,<br>                name: <span class="hljs-string">'7/2'</span><br>              }<br>            ]<br>          },<br>          {<br>            id: <span class="hljs-number">3</span>,<br>            pid: <span class="hljs-number">1</span>,<br>            name: <span class="hljs-string">'3/1'</span>,<br>            children: [<br>              {<br>                id: <span class="hljs-number">4</span>,<br>                pid: <span class="hljs-number">3</span>,<br>                name: <span class="hljs-string">'4/3'</span><br>              }<br>            ]<br>          }<br>        ]<br>      },<br>      {<br>        id: <span class="hljs-number">5</span>,<br>        pid: <span class="hljs-number">0</span>,<br>        name: <span class="hljs-string">'5/0'</span>,<br>        children: [<br>          {<br>            id: <span class="hljs-number">6</span>,<br>            pid: <span class="hljs-number">5</span>,<br>            name: <span class="hljs-string">'6/5'</span><br>          }<br>        ]<br>      }<br>    ]<br>  }<br>]<br></code></pre></td></tr></tbody></table></figure><h2 id="树形数据结构-gt-扁平数据结构">树形数据结构=>扁平数据结构<a class="post-anchor" href="#树形数据结构-gt-扁平数据结构"></a></h2><blockquote><p>目前的处理方法就是递归，因为不知道有多次层级，有新的想法请与我联系！</p></blockquote><figure class="highlight js"><table><tbody><tr><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NestedToFlat</span>(<span class="hljs-params">data</span>) </span>{<br>  <span class="hljs-keyword">let</span> result = []<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < data.length; i++) {<br>    result.push({<br>      id: data[i][<span class="hljs-string">'id'</span>],<br>      pid: data[i][<span class="hljs-string">'pid'</span>],<br>      name: data[i][<span class="hljs-string">'name'</span>]<br>    })<br><br>    <span class="hljs-keyword">if</span> (data[i][<span class="hljs-string">'children'</span>]) {<br>      result = result.concat(<span class="hljs-keyword">this</span>.demo(data[i].children))<br>    }<br>  }<br><br>  <span class="hljs-keyword">return</span> result<br>}<br></code></pre></td></tr></tbody></table></figure></body></html>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UDFToTopN作业</title>
      <link href="/2017/11/30/UDFToTopN%E4%BD%9C%E4%B8%9A/"/>
      <url>/2017/11/30/UDFToTopN%E4%BD%9C%E4%B8%9A/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h3 id="使用-MockClassData生成数据">使用 MockClassData生成数据<a class="post-anchor" href="#使用-MockClassData生成数据"></a></h3><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><code class="hljs javascript">package com.cj.bigdata.hive.hiveWork;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.Random;<br><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MockClassData</span> </span>{<br>    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-built_in">String</span>[] args) throws IOException {<br><span class="hljs-comment">//        String[] words = new String[]{,3837,47843,32u39,438948,43984,43849,545,54k"};</span><br>        <span class="hljs-built_in">String</span> words[] = {<span class="hljs-string">"123"</span>,<span class="hljs-string">"4354"</span>,<span class="hljs-string">"43541"</span>,<span class="hljs-string">"43542"</span>,<span class="hljs-string">"43543"</span>,<span class="hljs-string">"43544"</span>,<span class="hljs-string">"43545"</span>,<span class="hljs-string">"43546"</span>,<span class="hljs-string">"43547"</span>,<span class="hljs-string">"43548"</span>};<br>        Random random = <span class="hljs-keyword">new</span> Random();<br><br>        BufferedWriter bufferedWriter = <span class="hljs-keyword">new</span> BufferedWriter(<span class="hljs-keyword">new</span> OutputStreamWriter(<span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"data/input/classData.txt"</span>))));<br><br>        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i < <span class="hljs-number">30000</span>; i++) {<br>                bufferedWriter.write(<span class="hljs-string">"http://ruozedata.com/course/"</span> + words[random.nextInt(words.length)]);<br>                <span class="hljs-keyword">if</span>(random.nextInt(<span class="hljs-number">4</span>) != <span class="hljs-number">0</span>){<br>                    bufferedWriter.write(<span class="hljs-string">"/"</span> + random.nextInt(<span class="hljs-number">3</span>) + <span class="hljs-string">".html?a=b&c=d"</span>);<br>                    bufferedWriter.newLine();<br>                }<span class="hljs-keyword">else</span> {<br>                    bufferedWriter.write(<span class="hljs-string">".html"</span>);<br>                    bufferedWriter.newLine();<br>                }<br><br><br>        }<br><br>        bufferedWriter.flush();<br>        bufferedWriter.close();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="创建表">创建表<a class="post-anchor" href="#创建表"></a></h3><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><code class="hljs javascript">CREATE TABLE <span class="hljs-string">`default.class`</span>(<br>  <span class="hljs-string">`class_str`</span> string)<br></code></pre></td></tr></tbody></table></figure><h3 id="将数据upload服务器并import到table-class">将数据upload服务器并import到table class<a class="post-anchor" href="#将数据upload服务器并import到table-class"></a></h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><code class="hljs plain">load data local inpath '/home/jackson/data/classData.txt'  overwrite into table class;<br>#检查数据<br>select * from class limit 10;<br></code></pre></td></tr></tbody></table></figure><h3 id="编写UDFParseClassCode">编写UDFParseClassCode<a class="post-anchor" href="#编写UDFParseClassCode"></a></h3><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><code class="hljs javascript">package com.cj.bigdata.hive.hiveWork;<br><br><span class="hljs-keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;<br><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UDFParseClassCode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UDF</span> </span>{<br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * http://ruozedata.com/course/4354/2.html?a=b&c=d</span><br><span class="hljs-comment">     * http://ruozedata.com/course/43548.html</span><br><span class="hljs-comment">     */</span><br>    public <span class="hljs-built_in">String</span> evaluate(<span class="hljs-built_in">String</span> str){<br>        StringBuffer buffer = <span class="hljs-keyword">new</span> StringBuffer();<br><br>        <span class="hljs-built_in">String</span>[] splits01 = str.split(<span class="hljs-string">".html"</span>);<br>        <span class="hljs-comment">//http://ruozedata.com/course/4354/2或http://ruozedata.com/course/43548</span><br>        <span class="hljs-built_in">String</span> splits02 = splits01[<span class="hljs-number">0</span>];<br>        <span class="hljs-built_in">String</span>[] splits03 = splits02.split(<span class="hljs-string">"/"</span>);<br><br>        <span class="hljs-comment">//用split后的的最后一块的长度来判断是//http://ruozedata.com/course/4354/2还是http://ruozedata.com/course/43548</span><br>        <span class="hljs-keyword">if</span>(splits03[splits03.length - <span class="hljs-number">1</span>].length() == <span class="hljs-number">1</span>){<br>            buffer.append(splits03[splits03.length - <span class="hljs-number">2</span>]);<br>            buffer.append(<span class="hljs-string">"_"</span>);<br>            buffer.append(splits03[splits03.length - <span class="hljs-number">1</span>]);<br>        }<span class="hljs-keyword">else</span> {<br>            buffer.append(splits03[splits03.length - <span class="hljs-number">1</span>]);<br>        }<br><br>        <span class="hljs-keyword">return</span> buffer.toString();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="打包上传生成UDF函数">打包上传生成UDF函数<a class="post-anchor" href="#打包上传生成UDF函数"></a></h3><h4 id="上传到-HIVE-HOME-auxlib">上传到$HIVE_HOME/auxlib<a class="post-anchor" href="#上传到-HIVE-HOME-auxlib"></a></h4><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><code class="hljs plain">CREATE TEMPORARY FUNCTION parseClass  AS 'com.cj.bigdata.hive.hiveWork.UDFParseClassCode';<br></code></pre></td></tr></tbody></table></figure><h4 id="sql完成需求">sql完成需求<a class="post-anchor" href="#sql完成需求"></a></h4><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><code class="hljs plain">select <br>    parseClass(class_str)  class_code,<br>    count(*)<br>from class<br>    group by parseClass(class_str)<br>    limit 10<br>    ;<br></code></pre></td></tr></tbody></table></figure><p><strong>结果：</strong><br><a href="https://yanxuan.nosdn.127.net/b4fd6361cfb4539d14743e582c11e6bb.jpg" data-caption="enter description here" data-fancybox="images"><img src="https://yanxuan.nosdn.127.net/b4fd6361cfb4539d14743e582c11e6bb.jpg" alt="enter description here"></a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hive </tag>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
